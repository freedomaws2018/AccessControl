<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{comm/layout}">
<head>
<meta charset="UTF-8">
<title>LineUser - 列表</title>
</head>
<body layout:fragment="content">
  <script type="text/javascript">

  var delete_user = function(id,name){
    showConfirmDialog('確認刪除','確定要刪除 ' + name + ' 嗎?',function(){
      $.ajax({
        type: 'DELETE',
        url: "/line/user/delete/" + id,
        dataType: 'json',
        success: (result) =>{
          location.reload();
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
          location.reload();
        }
      });
    });
    
  }
  
  $().ready(function(){
	  $("a[id^='delete_user']").click(function(){
		  var lineUserId = $(this).attr("lineUserId");
	  
	  });
  });
  
  </script>
  <div th:if="|${funcType eq 'view' and info_status ne null}|" class="alert alert-success" role="alert" th:text="${info_status}"></div>
  <div th:if="|${funcType eq 'view' and error_status ne null}|" class="alert alert-warning" role="alert" th:text="${error_status}"></div>
  <div class="row">
  	<div class="col-12">
  		<div class="card">
  			<div class="card-header" toggleId="l-line-user-toggle">
  				<span class="glyphicon glyphicon-align-justify"></span>LineUser - 列表
  			</div>
  			<div class="card-body" toggleId="l-line-user-toggle">
  				<table class="table table-hover table-responsive-sm hide-in-phone">
  					<thead class="center">
  						<tr>
  							<th scope="col">操作</th>
  							<th scope="col">姓名</th>
  							<th scope="col">使用狀態</th>
  						</tr>
  					</thead>
  					<tbody class="center">
                            <tr>
                              <th th:if="${users.empty}" colspan="6">沒有資料</th>
                            </tr>
  						<tr th:unless="${users.empty}" th:each="user,itemStar:${users}">
  							<th scope="row">
                              <a class="btn btn-sm btn-secondary" th:href="@{/line/user/view/__${user.userId}__}" >
                                <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>檢視
                              </a>
  					          <a class="btn btn-success btn-sm" th:href="@{/line/user/edit/{userId}(userId=${user.userId})}" >
  					          	<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>修改
  					          </a>
  					          <a class="btn btn-danger btn-sm" th:onclick="|delete_user('__${user.userId}__','__${user.userName}__')|" th:lineUserId="${user.userId}" href="javascript:;" >
  					          	<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>刪除
  					          </a>
  							</th>
  							<td th:text="${user.userName}">姓名</td>
  							<td>
                                  <script th:inline="javascript">
                                  	var now = Date.now();
                                  	var isUse = [[${user.isUse}]];
                                  	var begDt = Date.parse([[${user.begDt}]]);
                                  	var endDt = Date.parse([[${user.endDt}]]);
                                  	if(isUse){
                                    	if(now >= begDt && endDt >= 4102415940000){
                                    	  document.write("終身有效");
                                    	}else if(now >= begDt && now <= endDt){
                                    	  document.write("到 " + [[${#temporals.format(user.endDt, 'yyyy-MM-dd HH:mm')}]] + " 止" )
                                    	}else{
                                    	  document.write("禁止使用")
                                    	}
                                  	}else{
                                  	  document.write("停止使用")
                                  	}
                                  </script>
  							</td>
  						</tr>
  					</tbody>
  				</table>
  				<table class="table-hover show-on-phone rwd-table">
  					<thead>
  						<tr>
  							<th>操作</th>
  							<th>姓名</th>
  							<th>是否啟用</th>
  							<th>使用時間</th>
  							<th>建立時間</th>
  							<th>修改時間</th>
  						</tr>
  					</thead>
  					<tbody>
                            <tr>
                              <th th:if="${users.empty}" colspan="6">沒有資料</th>
                            </tr>
  						<tr th:unless="${users.empty}" th:each="user,itemStar:${users}">
  							<td class="td-first">
  					          <a th:href="@{/line/user/edit/{userId}(userId=${user.userId})}" class="btn btn-success btn-sm">
  					          	<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
  					          </a>
  					          <a th:id="|delete_user_${itemStar.index}|" th:lineUserId="${user.userId}" href="javascript:;" class="btn btn-danger btn-sm">
  					          	<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
  					          </a>
  							</td>
  							<td data-th="姓名：">
  							  <span th:text="${user.userName}"></span>
  							</td>
  							<td data-th="是否啟用：">
  							  <span th:if="${user.isUse}">是</span>
  					          <span th:unless="${user.isUse}">否</span>
  					        </td>
  							<td data-th="使用時間：">
  							  <span th:text="${user.begDt}"></span> 至
  							  <span th:text="${user.endDt}"></span>
  							</td>
  							<td data-th="建立時間：">
  							  <span th:text="${user.createDate}"></span>
  							</td>
  							<td data-th="修改時間：" class="td-last">
  				        	  <span th:text="${user.modifyDate}"></span>
  							</td>
  						</tr>
  					</tbody>
  				</table>
                    <div th:if="${users.totalPages gt 1}" >
                      <div th:replace="~{comm/page :: page01(entity=${users})}"></div>
                    </div>
  			</div>
  		</div>
  	</div>
  </div>
</body>
</html>