<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{comm/layout}">
<head>
<meta charset="UTF-8">
	<!-- CSS -->
	<link rel=stylesheet type="text/css" th:href="@{/css/edit_table_style.css}">
	
<title th:if="${funcType} == view">LineUser - 檢視</title>
<title th:if="${funcType} == edit">LineUser - 修改</title>
</head>
<body layout:fragment="content">

<script type="text/javascript">
"use strict";
$().ready(function(){
  /** 全選 **/
  $("a[id^='select_all']").click(function(){
    var that = this;
    var text = this.text;
    var index = $(this).attr('index');
    $(`input[type='checkbox'][name^='mappings'][index='${index}']`).each(function(){
      if(text === '全選'){
        $(this).prop('checked',true);
        that.text = '全消';
      }else{
        $(this).prop('checked',false);
        that.text = '全選';
      }
    });
  });
  
});
</script>
  <!-- <h1><a th:if="${funcType eq 'view'}">LineUser - 檢視</a></h1> -->
  <!-- <h1><a th:if="${funcType eq 'edit'}">LineUser - 修改</a></h1> -->
  
  <div th:if="|${funcType eq 'view' and info_status ne null}|" class="alert alert-success" role="alert" th:text="${info_status}"></div>
  <div th:if="|${funcType eq 'view' and error_status ne null}|" class="alert alert-warning" role="alert" th:text="${error_status}"></div>
  
  <form th:action="@{/line/user/save}" method="post">

  
	<div class="row">
		<div class="col">
			<div class="card">
				<div class="card-header">
					<span class="glyphicon glyphicon-align-justify"></span>
					<a th:if="${funcType eq 'view'}">LineUser - 檢視</a>
  					<a th:if="${funcType eq 'edit'}">LineUser - 修改</a> 
  					<a th:if="${funcType eq 'view'}" th:href="@{/line/user/edit/{userId}(userId=${User.userId})}" class="btn btn-success btn-sm a-btn-second">
  						<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>修改
  					</a>
				</div>
				<div class="card-body">
				    <table class="table table-responsive-sm">
				      <tbody>
				        <tr>
				          <th>使用者編號</th>
				          <td>
				            <input type="hidden" name="userId" th:value="${User.userId}" />
				            <span th:text="${User.userId}">UserId</span>
				          </td>
				        </tr>
				      
				        <tr>
				          <th>使用者名稱</th>
				          <td th:if="${funcType} == view"><span th:text="${User.userName}"></span></td>
				          <td th:if="${funcType} == edit"><input name="userName" th:value="${User.userName}" /></td>
				        </tr>
				      
				        <tr>
				          <th>是否啟用</th>
				          <td th:if="${funcType} == view"><span th:text="${User.isUse ? '是' : '否' }"></span></td>
				          <td th:if="${funcType} == edit">
				            <input type="radio" id="isUseTrue" name="isUse" value="true" th:checked="${User.isUse}" /> <label for="isUseTrue">是</label>
				            <input type="radio" id="isUseFalse" name="isUse" value="false" th:checked="not ${User.isUse}" /> <label for="isUseFalse">否</label>
				          </td>
				        </tr>
				        
				        <tr>
				          <th>有效時限</th>
				          <td th:if="${funcType} == view"><span th:text="${#temporals.format(User.begDt, 'yyyy/MM/dd HH:mm:ss')}"></span> &rArr; <span th:text="${#temporals.format(User.endDt, 'yyyy/MM/dd HH:mm:ss')}"></span></td>
				          <td th:if="${funcType} == edit"><input name="begDt" th:value="${#temporals.format(User.begDt, 'yyyy/MM/dd HH:mm:ss')}" /> &rArr; <input name="endDt" th:value="${#temporals.format(User.endDt, 'yyyy/MM/dd HH:mm:ss')}" /></td>
				        </tr>
				        
				        <tr>
				          <th>權限分配</th>
				          <td>
				            <table class="table table-responsive-sm">
				              <thead>
				                <tr>
				                  <th>設備編號</th>
				                  <th>功能選單</th>
				                </tr>
				              </thead>
				              <tbody>
				                <tr th:each="detail,iterStat1 :${groupBySnDetails}">
				                  <th>
				                    <a th:if="${funcType eq 'edit'}" href="javascript:;" th:id="|select_all[${iterStat1.index}]|" th:index="${iterStat1.index}" >全選</a>
				                    <BR th:if="${funcType eq 'edit'}">
				                    <span th:text="${detail.key}">Wf8266 - 設備編號</span>
				                  </th>
				                  <td>
				                    <span th:each="datas,iterStat2:${detail.value}">
				                      <label><input th:disabled="${funcType eq 'view'}" type="checkbox" th:index="${iterStat1.index}" th:name="|mappings[${iterStat1.index *10 + iterStat2.index}].isUse|" th:text="${datas.name}" th:checked="${datas.isUse}" /></label>
				                      <input type="hidden" th:name="|mappings[${iterStat1.index *10 + iterStat2.index}].userId|" th:value="${User.userId}" />
				                      <input type="hidden" th:name="|mappings[${iterStat1.index *10 + iterStat2.index}].triggerText|" th:value="${datas.triggerText}" />
				                    </span>
				                  </td>
				                </tr>
				              </tbody>
				            </table>
				          </td>
				        </tr>
				        <tr>
				          <th>當前使用選單</th>
				          <td th:if="${funcType} == view">
				            <span th:unless="${richMenu.richMenuId == null}" th:text="${richMenu.name}"></span>
				            <span th:if="${richMenu.richMenuId == null}" >無</span>
				          </td>
				          <td th:if="${funcType} == edit">
				            <select name="richMenuId">
				              <option value="">請選擇</option>
				              <option th:each="menu:${allRichMenu}" th:object="${menu}" th:value="*{richMenuId}" th:text="*{name}" th:selected="*{richMenuId} == ${richMenu.richMenuId}"></option>
				            </select>
				          </td>
				        </tr>
				      
				        <tr>
				          <td colspan="2">
				            <label>建立時間：<span th:text="${#temporals.format(User.createDate, 'yyyy/MM/dd HH:mm:ss')}"></span></label>
				            <label>修改時間：<span th:text="${#temporals.format(User.modifyDate, 'yyyy/MM/dd HH:mm:ss')}"></span></label>
				          </td>
				        </tr>
				      
				      </tbody>
				      <tfoot th:if="${funcType} == edit">
				        <tr>
				          <td colspan="2">
				          	<button type="submit" class="btn btn-primary btn-sm">
				          		<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>送出
						  	</button>
				          </td>
				        </tr>
				      </tfoot>
				    </table>
    	</div>
			</div>
		</div>
	</div>
  </form>

</body>
</html>